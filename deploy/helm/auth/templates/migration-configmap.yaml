kind: ConfigMap
apiVersion: v1
metadata:
  name: bash-script-migrations
data:  
  run-migrations.sh: |-
    #!/bin/sh

    printenv
    echo $(ls)
    apk --no-cache add curl
    curl -fsSL https://raw.githubusercontent.com/pressly/goose/master/install.sh | GOOSE_INSTALL=$HOME/.goose sh -s v3.20.0

    chmod +x $HOME/.goose/bin/goose

    set GOOSE_DBSTRING=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:${POSTGRES_PORT}/${POSTGRES_DB}?sslmode=disable
    $HOME/.goose/bin/goose -dir opt/service/auth/migrations/postgres postgres up
